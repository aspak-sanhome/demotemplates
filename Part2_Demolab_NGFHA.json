{
  "AWSTemplateFormatVersion": "2010-09-09",
   "Description" : "Barracuda NextGen Firewall Demo Lab VPC",

  "Parameters" : {


   "ArchTagName" : {
    	"Type" : "String",
    	"Default" : "DemoLabVPC",
    	"Description" : "Enter the Modifier prepended to resources of this template"
    },
    "KeyName" : {
      "Description" : "Name of an existing EC2 KeyPair to enable SSH access to the instances",
      "Type" : "AWS::EC2::KeyPair::KeyName",
      "ConstraintDescription" : "Must be the name of an existing EC2 KeyPair.",
      "Default" : "MZ_keys"
    }

  },


  "Resources": {

    "HAStackNGF1":{
          "Type" : "AWS::CloudFormation::Stack",
        	       "Properties" : {
        	           "TemplateURL" : "https://s3-eu-west-1.amazonaws.com/campustemplates/nested/managed-generic.json",
        	           "Parameters" : {
                       "LicenceMode": "PAYG",
                       "InstanceType": "t2.small",
                       "KeyName" : {"Ref" : "KeyName"},
                       "IAMProfile": "NextGenFirewallRole",
                       "CCIPAddress": "10.100.1.10",
                       "CCUser": "root",
                       "CCPassword": "Ziosch17$",
                       "CCCluster": "Frankfurt",
                       "CCRange": "1",
                       "CCBoxname": "HQ-NGF1",
                       "PrivateIpAddress": "10.100.0.10",
                       "SecondaryPrivateIpAddress": "10.100.0.15",
                       "VPCId": "vpc-7f2a6e18",
                       "SubnetId": "subnet-3b21525c"
        	           },
                     "TimeoutInMinutes" : "10"
                }
              },

              "HAStackNGF2":{
                    "Type" : "AWS::CloudFormation::Stack",
                           "Properties" : {
                               "TemplateURL" : "https://s3-eu-west-1.amazonaws.com/campustemplates/nested/managed-generic.json",
                               "Parameters" : {
                                 "LicenceMode": "PAYG",
                                 "InstanceType": "t2.small",
                                 "KeyName" : { "Ref" : "KeyName"},
                                 "IAMProfile": "NextGenFirewallRole",
                                 "CCIPAddress": "10.100.1.10",
                                 "CCUser": "root",
                                 "CCPassword": "Ziosch17$",
                                 "CCCluster": "Frankfurt",
                                 "CCRange": "1",
                                 "CCBoxname": "HQ-NGF2",
                                 "PrivateIpAddress": "10.100.10.10",
                                 "SecondaryPrivateIpAddress": "10.100.10.15",
                                 "VPCId": "vpc-7f2a6e18",
                                 "SubnetId": "subnet-f3007aba"
                               }
                          }
                        },

                        "EIPtoHANGF1":{
                              "Type" : "AWS::CloudFormation::Stack",
                              "DependsOn" :"HAStackNGF1",
                                     "Properties" : {
                                         "TemplateURL" : "https://s3-eu-west-1.amazonaws.com/campustemplates/nested/associateEIP.json",
                                         "Parameters" : {
                                           "EIPaddressIdPrimary" : "eipalloc-07d2eb3d",
                                           "EIPaddressIdSecondary" : "eipalloc-b1cdca8b",
                                           "instanceId" :  { "Fn::GetAtt" : [ "HAStackNGF1", "Outputs.instanceId" ] },
                                           "PrimaryPrivateIPAddress" : "10.100.0.10",
                                           "SecondaryPrivateIpAddress" : "10.100.0.15"
                                         }
                                    }
                                  },

                        "EIPHANGF2":{
                              "Type" : "AWS::CloudFormation::Stack",
                               "DependsOn" : "HAStackNGF2",
                              "Properties" : {
                                   "TemplateURL" : "https://s3-eu-west-1.amazonaws.com/campustemplates/nested/associateEIP.json",
                                   "Parameters" : {
                                   "EIPaddressIdPrimary" : "eipalloc-94d5ecae",
                                   "EIPaddressIdSecondary" : "eipalloc-a2cacd98",
                                   "instanceId" :  { "Fn::GetAtt" : [ "HAStackNGF2", "Outputs.instanceId" ] },
                                   "PrimaryPrivateIPAddress" : "10.100.10.10",
                                   "SecondaryPrivateIpAddress" : "10.100.10.15"
                                         }
                                    }
                                  }

 },

 "Outputs" : {
  }


 }
